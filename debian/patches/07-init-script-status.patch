Description: Add a 'status' command to the init script
Author: Peter Pentchev <roam@ringlet.net>
Forwarded: not-yet
Bug-Debian: http://bugs.debian.org/548974
Last-Update: 2014-04-04

--- a/tools/stunnel.init.in
+++ b/tools/stunnel.init.in
@@ -69,6 +69,24 @@
   done
 }
 
+querydaemons()
+{
+  res=0
+  echo -n "$DESC status:"
+  for file in $FILES; do
+    echo -n " $file: "
+    PROCLIST=`get_pids $file`
+    if [ "$PROCLIST" ] && kill -s 0 $PROCLIST 2>/dev/null; then
+      echo -n 'running'
+    else
+      echo -n 'stopped'
+      res=1
+    fi
+  done
+  echo ''
+  exit "$res"
+}
+
 if [ "x$OPTIONS" != "x" ]; then
   OPTIONS="-- $OPTIONS"
 fi
@@ -127,9 +145,12 @@
         startdaemons
         echo "$NAME."
         ;;
+  status)
+	querydaemons
+	;;
   *)
         N=/etc/init.d/$NAME
-        echo "Usage: $N {start|stop|reload|reopen-logs|restart} [<stunnel instance>]" >&2
+        echo "Usage: $N {start|stop|status|reload|reopen-logs|restart} [<stunnel instance>]" >&2
         exit 1
         ;;
 esac
